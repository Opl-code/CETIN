<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSON to CSV Converter</title>
</head>
<body>
  <h1>JSON to CSV Converter (KIA â†’ ROP_ID)</h1>

  <input type="file" id="jsonFile" accept=".json"><br><br>
  <button onclick="handleFile()">Convert to CSV</button><br><br>

  <a id="downloadLink" style="display:none;">Download CSV</a>

  <script>
    function handleFile() {
      const fileInput = document.getElementById('jsonFile');
      const file = fileInput.files[0];

      if (!file) {
        alert("Please select a JSON file.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          convertToCSV(data);
        } catch (error) {
          alert("Invalid JSON file.");
        }
      };

      reader.readAsText(file);
    }

    function convertToCSV(data) {
      let grouped = {};
      for (let item of data) {
        let kia = item["KIA"];
        let rop = item["ROP_ID"];
        if (!kia || !rop) continue;

        if (!grouped[kia]) grouped[kia] = [];
        grouped[kia].push(rop);
      }

      let csvRows = [["KIA;ROP_ID"]];
      for (let kia in grouped) {
        csvRows.push([`${kia};${grouped[kia].join(",")}`]);
      }

      let csvContent = csvRows.map(e => e.join("")).join("\n");
      let blob = new Blob([csvContent], { type: 'text/csv' });
      let url = URL.createObjectURL(blob);

      let downloadLink = document.getElementById('downloadLink');
      downloadLink.href = url;
      downloadLink.download = "output.csv";
      downloadLink.style.display = "inline";
      downloadLink.textContent = "Download CSV";
    }
  </script>
</body>
</html>
